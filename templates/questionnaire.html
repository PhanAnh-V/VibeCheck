<!DOCTYPE html>
<html lang="ja">
<head>
    <meta charset="UTF-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>„Éü„Çπ„ÉÜ„É™„Éº„Ç∏„Çß„Éç„É¨„Éº„Çø„Éº - Vibe Check</title>
    <link href="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/css/bootstrap.min.css" rel="stylesheet">
    <link href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/6.0.0/css/all.min.css" rel="stylesheet">
    <link href="https://fonts.googleapis.com/css2?family=Noto+Sans+JP:wght@300;400;500;700&display=swap" rel="stylesheet">
</head>
<body>
    <div class="questionnaire-page">
        <!-- Navigation -->
        <nav class="navbar navbar-expand-lg mb-4">
            <div class="container">
                <a class="navbar-brand" href="{{ url_for('index') }}">
                    <i class="fas fa-bolt me-2"></i>Vibe Check
                </a>
                <div class="navbar-nav ms-auto">
                    <a class="nav-link" href="{{ url_for('find_squad') }}">
                        <i class="fas fa-search me-1"></i>„Éû„Ç§„Çπ„ÇØ„ÉØ„ÉÉ„Éâ„ÇíÊé¢„Åô
                    </a>
                    <a class="nav-link" href="{{ url_for('index') }}">
                        <i class="fas fa-key me-1"></i>Êñ∞„Åó„ÅÑ„Çª„ÉÉ„Ç∑„Éß„É≥
                    </a>
                </div>
            </div>
        </nav>

        <div class="container">
            <div class="row justify-content-center">
                <div class="col-lg-8 col-xl-6">
                    <div class="questionnaire-card">
                        <div class="questionnaire-header">
                            <div class="header-icon">
                                <i class="fas fa-user-circle"></i>
                            </div>
                            <h1 class="questionnaire-title">„Éü„Çπ„ÉÜ„É™„Éº„Ç∏„Çß„Éç„É¨„Éº„Çø„Éº</h1>
                            <p class="questionnaire-subtitle">
                                6„Å§„ÅÆË≥™Âïè„Å´Á≠î„Åà„Å¶„ÅÇ„Å™„Åü„ÅÆ„ÇØ„É™„Ç®„Ç§„ÉÜ„Ç£„Éñ„Çø„Ç§„Éó„ÇíÁô∫Ë¶ã„Åó„ÄÅ<br>
                                ÊúÄÈ´ò„ÅÆ„Éê„Ç§„Éñ„Çπ„ÇØ„ÉØ„ÉÉ„Éâ„Å®„Å§„Å™„Åå„Çç„ÅÜÔºÅ
                            </p>
                        </div>

                        <!-- Flash Messages -->

                        <form id="questionnaire-form" action="{{ url_for('submit_form') }}" method="POST" novalidate>
                            {{ form.hidden_tag() }}
                            
                            <!-- Name Field -->
                            <div class="form-section">
                                <div class="input-group">
                                    <label class="input-label">„ÅäÂêçÂâç</label>
                                    {{ form.name(class="form-input", placeholder="„Éï„É´„Éç„Éº„É†„ÇíÂÖ•Âäõ„Åó„Å¶„Åè„Å†„Åï„ÅÑ") }}
                                    {% if form.name.errors %}
                                        <div class="error-message">
                                            {% for error in form.name.errors %}
                                                {{ error }}
                                            {% endfor %}
                                        </div>
                                    {% endif %}
                                </div>
                            </div>

                            <!-- Mystery Generator Questions -->
                            <div class="questions-section">
                                <div class="section-header">
                                    <h3 class="section-title">
                                        <i class="fas fa-magic me-2"></i>
                                        „Éü„Çπ„ÉÜ„É™„Éº„Ç∏„Çß„Éç„É¨„Éº„Çø„ÉºË≥™Âïè
                                    </h3>
                                </div>
                            
                                {% if questions %}
                                    {% for i in range(6) %}
                                        {% set question_field = 'question' + (i + 1)|string %}
                                        {% set question_data = questions[i] if i < questions|length else {'title': 'Question ' + (i + 1)|string, 'description': 'Please answer this question.'} %}
                                        
                                        <div class="question-card">
                                            <div class="question-number">{{ i + 1 }}</div>
                                            <div class="question-content">
                                                <h4 class="question-title">{{ question_data.title }}</h4>
                                                <p class="question-description">{{ question_data.description }}</p>
                                                {{ form[question_field](class="question-input", maxlength="500", placeholder="„ÅÇ„Å™„Åü„ÅÆÁ≠î„Åà„Çí„Åì„Åì„Å´Êõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ...") }}
                                                {% if form[question_field].errors %}
                                                    <div class="error-message">
                                                        {% for error in form[question_field].errors %}
                                                            {{ error }}
                                                        {% endfor %}
                                                    </div>
                                                {% endif %}
                                            </div>
                                        </div>
                                    {% endfor %}
                                {% else %}
                                    <!-- Fallback to original form structure -->
                                    <div class="question-card">
                                        <div class="question-number">1</div>
                                        <div class="question-content">
                                            {{ form.question1.label(class="question-title") }}
                                            {{ form.question1(class="question-input", maxlength="500", placeholder="„ÅÇ„Å™„Åü„ÅÆÁ≠î„Åà„Çí„Åì„Åì„Å´Êõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ...") }}
                                            {% if form.question1.errors %}
                                                <div class="error-message">
                                                    {% for error in form.question1.errors %}
                                                        {{ error }}
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>

                                    <div class="question-card">
                                        <div class="question-number">2</div>
                                        <div class="question-content">
                                            {{ form.question2.label(class="question-title") }}
                                            {{ form.question2(class="question-input", maxlength="500", placeholder="„ÅÇ„Å™„Åü„ÅÆÁ≠î„Åà„Çí„Åì„Åì„Å´Êõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ...") }}
                                            {% if form.question2.errors %}
                                                <div class="error-message">
                                                    {% for error in form.question2.errors %}
                                                        {{ error }}
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                {% endif %}


                            </div>

                            <!-- Additional Information -->
                            <div class="additional-info-section">
                                <div class="section-header">
                                    <h3 class="section-title">
                                        <i class="fas fa-info-circle me-2"></i>
                                        ËøΩÂä†ÊÉÖÂ†±
                                    </h3>
                                </div>
                                
                                <div class="row g-3">
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <label class="input-label">ÂõΩ</label>
                                            <select name="country" id="country" class="form-select" required>
                                                <option value="" disabled selected>„ÅÇ„Å™„Åü„ÅÆÂõΩ„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                                <option value="China">‰∏≠ÂõΩ</option>
                                                <option value="Vietnam">„Éô„Éà„Éä„É†</option>
                                                <option value="Japan">Êó•Êú¨</option>
                                                <option value="Other">„Åù„ÅÆ‰ªñ</option>
                                            </select>
                                            {% if form.country.errors %}
                                                <div class="error-message">
                                                    {% for error in form.country.errors %}
                                                        {{ error }}
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                    
                                    <div class="col-md-6">
                                        <div class="input-group">
                                            <label class="input-label">ÊÄßÂà•</label>
                                            <select name="gender" id="gender" class="form-select" required>
                                                <option value="" disabled selected>„ÅÇ„Å™„Åü„ÅÆÊÄßÂà•„ÇíÈÅ∏Êäû„Åó„Å¶„Åè„Å†„Åï„ÅÑ</option>
                                                <option value="Male">Áî∑ÊÄß</option>
                                                <option value="Female">Â•≥ÊÄß</option>
                                                <option value="Prefer not to say">ÂõûÁ≠î„Åó„Å™„ÅÑ</option>
                                            </select>
                                            {% if form.gender.errors %}
                                                <div class="error-message">
                                                    {% for error in form.gender.errors %}
                                                        {{ error }}
                                                    {% endfor %}
                                                </div>
                                            {% endif %}
                                        </div>
                                    </div>
                                </div>
                            </div>

                            <div class="submit-section">
                                {{ form.submit(id="submit-btn", class="submit-button") }}
                            </div>
                        </form>
                    </div>
                </div>
            </div>
        </div>
    </div>

    <style>
        .questionnaire-page {
            min-height: 100vh;
            background: linear-gradient(135deg, #f5f7fa 0%, #c3cfe2 100%);
            font-family: 'Noto Sans JP', sans-serif;
            padding: 0;
        }

        .navbar {
            background: rgba(255, 255, 255, 0.95);
            backdrop-filter: blur(10px);
            border-bottom: 1px solid rgba(0, 0, 0, 0.1);
            padding: 1rem 0;
        }

        .navbar-brand {
            font-weight: 700;
            color: #667eea !important;
            font-size: 1.5rem;
        }

        .nav-link {
            color: #64748b !important;
            font-weight: 500;
            border-radius: 8px;
            padding: 0.5rem 1rem !important;
            margin: 0 0.25rem;
            transition: all 0.3s ease;
        }

        .nav-link:hover {
            background: rgba(102, 126, 234, 0.1);
            color: #667eea !important;
        }

        .questionnaire-card {
            background: white;
            border-radius: 24px;
            padding: 3rem 2.5rem;
            box-shadow: 0 20px 60px rgba(0, 0, 0, 0.08);
            border: 1px solid rgba(0, 0, 0, 0.05);
            margin: 2rem 0;
        }

        .questionnaire-header {
            text-align: center;
            margin-bottom: 3rem;
        }

        .header-icon {
            font-size: 4rem;
            color: #667eea;
            margin-bottom: 1.5rem;
        }

        .questionnaire-title {
            font-size: 2.5rem;
            font-weight: 800;
            color: #1f2937;
            margin-bottom: 1rem;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            -webkit-background-clip: text;
            -webkit-text-fill-color: transparent;
            background-clip: text;
        }

        .questionnaire-subtitle {
            font-size: 1.1rem;
            color: #6b7280;
            line-height: 1.6;
            max-width: 600px;
            margin: 0 auto;
        }

        .form-section {
            margin-bottom: 2.5rem;
        }

        .section-header {
            margin-bottom: 2rem;
        }

        .section-title {
            font-size: 1.5rem;
            font-weight: 700;
            color: #374151;
            display: flex;
            align-items: center;
            margin-bottom: 1rem;
        }

        .section-title i {
            color: #667eea;
        }

        .input-group {
            margin-bottom: 1.5rem;
        }

        .input-label {
            display: block;
            font-size: 0.95rem;
            font-weight: 600;
            color: #374151;
            margin-bottom: 0.5rem;
        }

        .form-input, .question-input {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            transition: all 0.3s ease;
            background: #fafafa;
            min-height: 50px;
            resize: vertical;
        }

        .question-input {
            min-height: 120px;
            max-height: 400px;
            padding: 1.25rem 1.5rem;
            line-height: 1.6;
            font-family: 'Noto Sans JP', sans-serif;
            overflow-y: auto;
            transition: all 0.3s ease, height 0.2s ease;
            white-space: normal !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
        }

        .form-input:focus, .question-input:focus {
            outline: none;
            border-color: #4f46e5;
            background: white;
            box-shadow: 0 0 0 3px rgba(79, 70, 229, 0.1);
            transform: scale(1.01);
        }

        .question-input:focus {
            border-color: #4f46e5;
            box-shadow: 0 0 0 4px rgba(79, 70, 229, 0.12);
        }

        /* Enhanced textarea styling for modern note-taking feel */
        .question-input {
            border-radius: 12px;
            border: 2px solid #e5e7eb;
            background: #fafbfc;
            font-weight: 400;
            letter-spacing: 0.01em;
            white-space: normal !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
        }

        .question-input:hover {
            border-color: #d1d5db;
            background: #ffffff;
        }

        .question-input::placeholder {
            color: #9ca3af;
            font-style: italic;
            opacity: 0.8;
        }

        /* Smooth scrollbar for textareas */
        .question-input::-webkit-scrollbar {
            width: 6px;
        }

        .question-input::-webkit-scrollbar-track {
            background: transparent;
        }

        .question-input::-webkit-scrollbar-thumb {
            background: #d1d5db;
            border-radius: 3px;
        }

        .question-input::-webkit-scrollbar-thumb:hover {
            background: #9ca3af;
        }

        /* Universal textarea text wrapping fix */
        textarea, 
        textarea.question-input,
        input[type="text"].question-input,
        .questionnaire-card textarea,
        .question-content textarea {
            white-space: normal !important;
            word-wrap: break-word !important;
            overflow-wrap: break-word !important;
            word-break: break-word !important;
        }

        .form-select {
            width: 100%;
            padding: 0.875rem 1rem;
            border: 2px solid #e5e7eb;
            border-radius: 12px;
            font-size: 1rem;
            background: #fafafa;
            transition: all 0.3s ease;
        }

        .form-select:focus {
            outline: none;
            border-color: #667eea;
            background: white;
            box-shadow: 0 0 0 3px rgba(102, 126, 234, 0.1);
        }

        .questions-section {
            margin: 3rem 0;
        }

        .question-card {
            background: #f8fafc;
            border-radius: 16px;
            padding: 2rem;
            margin-bottom: 2rem;
            border: 1px solid #e2e8f0;
            display: flex;
            gap: 1.5rem;
            transition: all 0.3s ease;
        }

        .question-card:hover {
            box-shadow: 0 10px 30px rgba(0, 0, 0, 0.05);
            transform: translateY(-2px);
        }

        .question-number {
            flex-shrink: 0;
            width: 40px;
            height: 40px;
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            color: white;
            border-radius: 12px;
            display: flex;
            align-items: center;
            justify-content: center;
            font-weight: 700;
            font-size: 1.1rem;
        }

        .question-content {
            flex: 1;
        }

        .question-title {
            font-size: 1.25rem;
            font-weight: 700;
            color: #1f2937;
            margin-bottom: 0.75rem;
            line-height: 1.4;
        }

        .question-description {
            font-size: 1rem;
            color: #4b5563;
            line-height: 1.6;
            margin-bottom: 1.25rem;
        }

        .additional-info-section {
            background: #f8fafc;
            border-radius: 16px;
            padding: 2rem;
            margin: 2.5rem 0;
            border: 1px solid #e2e8f0;
        }

        .submit-section {
            text-align: center;
            margin-top: 3rem;
        }

        .submit-button {
            background: linear-gradient(135deg, #667eea 0%, #764ba2 100%);
            border: none;
            color: white;
            padding: 1rem 3rem;
            font-size: 1.1rem;
            font-weight: 600;
            border-radius: 12px;
            transition: all 0.3s ease;
            min-width: 200px;
            cursor: pointer;
        }

        .submit-button:hover {
            transform: translateY(-2px);
            box-shadow: 0 15px 40px rgba(102, 126, 234, 0.4);
        }

        .submit-button:disabled {
            opacity: 0.7;
            cursor: not-allowed;
            transform: none;
        }

        .error-message {
            color: #dc2626;
            font-size: 0.875rem;
            margin-top: 0.5rem;
            font-weight: 500;
        }

        .alert {
            border-radius: 12px;
            border: none;
            margin-bottom: 2rem;
        }

        .alert-danger {
            background: #fef2f2;
            color: #991b1b;
            border-left: 4px solid #dc2626;
        }

        /* Mobile responsiveness */
        @media (max-width: 768px) {
            .questionnaire-page {
                padding: 0;
            }
            
            .navbar {
                padding: 0.8rem 0;
            }
            
            .navbar-brand {
                font-size: 1.2rem;
            }
            
            .nav-link {
                font-size: 0.9rem;
                padding: 0.4rem 0.8rem !important;
            }

            .questionnaire-card {
                padding: 1.5rem 1rem;
                margin: 0.5rem;
                border-radius: 15px;
                box-shadow: 0 10px 30px rgba(0, 0, 0, 0.1);
            }

            .questionnaire-title {
                font-size: 1.6rem;
                line-height: 1.3;
                margin-bottom: 0.5rem;
            }

            .questionnaire-subtitle {
                font-size: 0.9rem;
                margin-bottom: 1.5rem;
                line-height: 1.4;
            }

            .question-card {
                flex-direction: column;
                gap: 1rem;
                padding: 1.2rem;
                margin-bottom: 1.5rem;
                border-radius: 12px;
            }

            .question-number {
                align-self: flex-start;
                width: 35px;
                height: 35px;
                font-size: 1rem;
            }
            
            .question-title {
                font-size: 1.1rem;
                margin-bottom: 0.5rem;
            }
            
            .question-description {
                font-size: 0.9rem;
                line-height: 1.5;
                margin-bottom: 1rem;
            }
            
            .question-input {
                min-height: 100px;
                font-size: 0.9rem;
                padding: 0.8rem;
            }
            
            .additional-info-section {
                padding: 1.2rem;
                margin: 1rem 0;
                border-radius: 12px;
            }
            
            .form-input,
            .form-select {
                padding: 0.8rem;
                font-size: 0.9rem;
                border-radius: 10px;
            }

            .submit-button {
                width: 100%;
                padding: 1rem 2rem;
                font-size: 1rem;
                border-radius: 12px;
                margin-top: 1rem;
            }
            
            .container {
                padding: 0 0.5rem;
            }
            
            .col-lg-8 {
                padding: 0;
            }
        }

        /* Animation for form load */
        .questionnaire-card {
            animation: slideUp 0.6s ease-out;
        }

        @keyframes slideUp {
            from {
                opacity: 0;
                transform: translateY(30px);
            }
            to {
                opacity: 1;
                transform: translateY(0);
            }
        }
    </style>

    <script src="https://cdn.jsdelivr.net/npm/bootstrap@5.1.3/dist/js/bootstrap.bundle.min.js"></script>
    
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            const form = document.getElementById('questionnaire-form');
            const submitBtn = document.getElementById('submit-btn');
            const originalText = 'ÈÄÅ‰ø°';
            
            // Set Japanese text for submit button and reset state
            if (submitBtn) {
                submitBtn.textContent = originalText;
                submitBtn.disabled = false;
                submitBtn.style.opacity = '1';
            }
            
            // Reset submit button if there are form errors on page load
            const formErrors = document.querySelectorAll('.error-message');
            if (formErrors.length > 0 && submitBtn) {
                submitBtn.disabled = false;
                submitBtn.textContent = originalText;
                submitBtn.style.opacity = '1';
            }
            
            // Enhanced form submission with validation and loading state
            if (form && submitBtn) {
                form.addEventListener('submit', function(e) {
                    // Prevent double submission
                    if (submitBtn.disabled) {
                        e.preventDefault();
                        return;
                    }
                    
                    // Validate all required fields before submission
                    let hasErrors = false;
                    const errorMessages = [];
                    
                    // Check all question textareas
                    for (let i = 1; i <= 6; i++) {
                        const textarea = document.getElementById(`question${i}`);
                        if (!textarea || !textarea.value.trim()) {
                            hasErrors = true;
                            errorMessages.push(`Ë≥™Âïè ${i} „ÅÆÂõûÁ≠î„ÅåÂøÖË¶Å„Åß„Åô`);
                        }
                    }
                    
                    // Check name field
                    const nameField = document.getElementById('name');
                    if (!nameField || !nameField.value.trim()) {
                        hasErrors = true;
                        errorMessages.push('„ÅäÂêçÂâç„ÅÆÂÖ•Âäõ„ÅåÂøÖË¶Å„Åß„Åô');
                    }
                    
                    // Check country selection
                    const countryField = document.getElementById('country');
                    if (!countryField || !countryField.value) {
                        hasErrors = true;
                        errorMessages.push('ÂõΩ„ÅÆÈÅ∏Êäû„ÅåÂøÖË¶Å„Åß„Åô');
                    }
                    
                    // Check gender selection
                    const genderField = document.getElementById('gender');
                    if (!genderField || !genderField.value) {
                        hasErrors = true;
                        errorMessages.push('ÊÄßÂà•„ÅÆÈÅ∏Êäû„ÅåÂøÖË¶Å„Åß„Åô');
                    }
                    
                    // If validation fails, prevent submission and show error
                    if (hasErrors) {
                        e.preventDefault();
                        alert('„Åô„Åπ„Å¶„ÅÆÂøÖÈ†àÈ†ÖÁõÆ„ÇíÂÆå‰∫Ü„Åó„Å¶„Åè„Å†„Åï„ÅÑ:\n\n' + errorMessages.join('\n'));
                        
                        // Reset submit button to normal state
                        submitBtn.disabled = false;
                        submitBtn.textContent = originalText;
                        submitBtn.style.opacity = '1';
                        return;
                    }
                    
                    // Show loading state
                    submitBtn.disabled = true;
                    submitBtn.innerHTML = '<i class="fas fa-spinner fa-spin me-2"></i>ÈÄÅ‰ø°‰∏≠...';
                    submitBtn.style.opacity = '0.7';
                });
                
                // Prevent accidental form submission on Enter key in text fields
                const allInputs = form.querySelectorAll('input, textarea, select');
                allInputs.forEach(input => {
                    if (input.type !== 'submit') {
                        input.addEventListener('keydown', function(e) {
                            if (e.key === 'Enter') {
                                e.preventDefault();
                                // Move to next field instead
                                const nextInput = Array.from(allInputs).find(el => 
                                    el.tabIndex > input.tabIndex || 
                                    (el.tabIndex === 0 && input.tabIndex === 0 && 
                                     Array.from(allInputs).indexOf(el) > Array.from(allInputs).indexOf(input))
                                );
                                if (nextInput) {
                                    nextInput.focus();
                                }
                            }
                        });
                    }
                });
            }
            
            // Smart Textarea Functionality
            const questionTextareas = document.querySelectorAll('.question-input');
            
            // Auto-expand functionality
            function autoExpand(textarea) {
                textarea.style.height = 'auto';
                const newHeight = Math.max(120, Math.min(400, textarea.scrollHeight));
                textarea.style.height = newHeight + 'px';
            }
            
            // Initialize and add event listeners for question textareas
            questionTextareas.forEach(textarea => {
                // Set initial height
                autoExpand(textarea);
                
                // Auto-expand on input
                textarea.addEventListener('input', function() {
                    autoExpand(this);
                });
                
                // Prevent accidental form submission on Enter (allow Shift+Enter for new lines)
                textarea.addEventListener('keydown', function(e) {
                    if (e.key === 'Enter' && !e.shiftKey) {
                        e.preventDefault();
                        
                        // Insert a new line manually
                        const start = this.selectionStart;
                        const end = this.selectionEnd;
                        const value = this.value;
                        
                        this.value = value.substring(0, start) + '\n' + value.substring(end);
                        this.selectionStart = this.selectionEnd = start + 1;
                        
                        // Trigger auto-expand
                        autoExpand(this);
                        
                        // Trigger input event for other listeners
                        this.dispatchEvent(new Event('input'));
                    }
                });
                
                // Smooth focus animation
                textarea.addEventListener('focus', function() {
                    this.parentElement.style.transform = 'scale(1.01)';
                    this.parentElement.style.transition = 'transform 0.2s ease';
                });
                
                textarea.addEventListener('blur', function() {
                    this.parentElement.style.transform = 'scale(1)';
                });
            });
            
            // Add smooth focus animations for other inputs
            const otherInputs = document.querySelectorAll('.form-input, .form-select');
            otherInputs.forEach(input => {
                input.addEventListener('focus', function() {
                    this.parentElement.style.transform = 'scale(1.02)';
                    this.parentElement.style.transition = 'transform 0.2s ease';
                });
                
                input.addEventListener('blur', function() {
                    this.parentElement.style.transform = 'scale(1)';
                });
            });
            
            // Progress tracking will be handled by main.js validation
            
            // Add helpful hint for users about Enter key behavior
            const firstTextarea = document.querySelector('.question-input');
            if (firstTextarea) {
                firstTextarea.addEventListener('focus', function() {
                    if (!this.dataset.hintShown) {
                        this.placeholder = '„ÅÇ„Å™„Åü„ÅÆÁ≠î„Åà„Çí„Åì„Åì„Å´Êõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ... (Enter„ÅßÊîπË°å„ÄÅShift+Enter„Åß„ÇÇÊîπË°å„Åß„Åç„Åæ„Åô)';
                        this.dataset.hintShown = 'true';
                        
                        setTimeout(() => {
                            this.placeholder = '„ÅÇ„Å™„Åü„ÅÆÁ≠î„Åà„Çí„Åì„Åì„Å´Êõ∏„ÅÑ„Å¶„Åè„Å†„Åï„ÅÑ...';
                        }, 3000);
                    }
                }, { once: true });
            }
        });
    </script>

    <!-- Magic Auto-Save Feature -->
    <script>
        document.addEventListener('DOMContentLoaded', function() {
            // Magic draft auto-save system
            const DRAFT_PREFIX = 'mystery_generator_draft_';
            
            // Get all question textareas
            const questionTextareas = document.querySelectorAll('textarea[name^="question"]');
            
            console.log('üéØ Auto-save initialized for', questionTextareas.length, 'questions');
            
            // Magic Loading: Restore any saved drafts when page loads
            questionTextareas.forEach((textarea, index) => {
                const questionNumber = index + 1;
                const draftKey = DRAFT_PREFIX + questionNumber;
                const savedDraft = localStorage.getItem(draftKey);
                
                if (savedDraft && savedDraft.trim() !== '') {
                    textarea.value = savedDraft;
                    console.log('‚ú® Restored draft for question', questionNumber);
                    
                    // Visual feedback: subtle highlight to show restoration
                    textarea.style.background = 'linear-gradient(135deg, #f0f9ff 0%, #e0f2fe 100%)';
                    setTimeout(() => {
                        textarea.style.background = '';
                    }, 2000);
                }
            });
            
            // Magic Saving: Auto-save on every keystroke
            questionTextareas.forEach((textarea, index) => {
                const questionNumber = index + 1;
                const draftKey = DRAFT_PREFIX + questionNumber;
                
                // Save on input (real-time auto-save)
                textarea.addEventListener('input', function() {
                    const content = this.value;
                    
                    if (content.trim() === '') {
                        // Remove empty drafts
                        localStorage.removeItem(draftKey);
                    } else {
                        // Save the draft
                        localStorage.setItem(draftKey, content);
                        console.log('üíæ Auto-saved question', questionNumber);
                    }
                });
                
                // Additional save on blur (when user moves away)
                textarea.addEventListener('blur', function() {
                    const content = this.value;
                    if (content.trim() !== '') {
                        localStorage.setItem(draftKey, content);
                    }
                });
            });
            
            // Magic Clearing: Clean up drafts after successful form submission
            const form = document.querySelector('form');
            if (form) {
                form.addEventListener('submit', function(e) {
                    // Only clear drafts after form validation passes
                    setTimeout(() => {
                        // Clear all drafts
                        for (let i = 1; i <= 6; i++) {
                            localStorage.removeItem(DRAFT_PREFIX + i);
                        }
                        console.log('üßπ Cleared all drafts after successful submission');
                    }, 1000); // Small delay to ensure form submission is processed
                });
            }
            
            // Bonus: Show draft indicator for user awareness
            function updateDraftIndicators() {
                questionTextareas.forEach((textarea, index) => {
                    const questionNumber = index + 1;
                    const draftKey = DRAFT_PREFIX + questionNumber;
                    const hasDraft = localStorage.getItem(draftKey);
                    
                    // Find the question card container
                    const questionCard = textarea.closest('.question-card');
                    if (questionCard && hasDraft) {
                        // Add subtle indicator that draft exists
                        if (!questionCard.querySelector('.draft-indicator')) {
                            const indicator = document.createElement('div');
                            indicator.className = 'draft-indicator';
                            indicator.innerHTML = 'üíæ';
                            indicator.style.cssText = `
                                position: absolute;
                                top: 10px;
                                right: 10px;
                                opacity: 0.6;
                                font-size: 12px;
                                pointer-events: none;
                            `;
                            questionCard.style.position = 'relative';
                            questionCard.appendChild(indicator);
                        }
                    }
                });
            }
            
            // Update indicators on page load
            setTimeout(updateDraftIndicators, 500);
        });
    </script>
    
    <!-- Enhanced form validation -->
    <script src="{{ url_for('static', filename='js/main.js') }}"></script>
</body>
</html>